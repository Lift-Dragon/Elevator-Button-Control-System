# Lift-Dragon

##Team that research and develop The Elevator Button Control System


###'''Project Subject'''
 엘리베이터를 사용하는 사람들 즉 타고있는 사람들과 탑승을 기다리는 사람들의 편의를 도와주는 역할을 하는 시스템을 개발한다.

### 팀이름
올라가용(Lift Dragon) - 엘리베이터의 기능과 중앙대학교의 상징을 결합한 언어유희.

### Member
20175119 김경태 - 아이디어 기획, CNNs for person head detection, 서버 구축, 아두이노, 라즈베리파이 세팅 및 시스템 구축 보조.

20175239 윤찬솔 - 아이디어 기획, OpenCV Person Body Face Detection, 아두이노, 라즈베리파이 세팅 및 시스템 구축.

20176705 이의섭 - 아이디어 기획, OpenCV Person Body Face Detection, 아두이노, 라즈베리파이 세팅 및 시스템 구축.


### Overview
#### '''엘리베이터를 타고있는 사람들의 불편'''
 엘리베이터 입구에 있는 탑승예정자가 있는지 인식하고 만약 탑승예정자가 없지만 엘리베이터 버튼이 눌려있는 경우 이를 취소해줌으로써 엘리베이터가 사람이 없는 층에 멈추는 것을 방지하여 탑승자의 시간낭비를 줄인다.
 
 #### '''엘리베이터를 타야하는 사람들의 불편'''
  엘레베이터 내부의 인원수(빈 공간)를 탑승을 기다리는 사람들이 확인할 수 있게하여 줄을 서도 탈 수가 없거나 하는 사태를 미연에 방지하고 여러 인원이 탑승해야할 때 같이 탈수 있을지 확인할 수 있게 한다.
  
### Motivation
#### '''사람이 없는데 눌려 있는 엘리베이터 버튼'''
 학교 엘리베이터를 이용할 때 여러대의 엘리베이터가 있지만 우리는 하나의 엘리베이터의 버튼을 누르고 기다리는게 아니라 탈 수 있는 여러 엘리베이터의 버튼을 누른다. 이로 인해 엘리베이터를 타고 가면서 엘리베이터가 사람도 없는데 문이 열려 시간을 뺏기는 경우가 있다.
 
#### '''기다렸는데 자리가 부족한 엘리베이터'''
 수업시작 10분전 같이 사람들이 몰려있는 시간대에 엘리베이터를 타려고 줄을 서있을 때, 내 앞에서 엘리베이터가 만원이 되어 줄 선 시간이 아깝게 타지 못하는 경우가 생긴다. 만약 자신이 줄을 서 있어도 엘리베이터에 탈 수가 없다는 것을 미리 알았다면 기다리는 시간에 걸어 올라가거나 다른 엘리베이터를 타러갔을 것이다.
 
 ### 목표
 #### '''1. 엘리베이터가 쓸데없이 멈추는 일을 막는다.'''
 #### '''2. 줄을 서있을 때 엘리베이터에 탑승할 수 있는지 미리 확인 가능하게한다.'''
 
 ### 개발 및 구현 내용
 #### '''엘리베이터 버튼 자동 취소 시스템'''
 - 엘리베이터 입구에 카메라를 설치해 영상 처리를 통해 탑승예정자가 있는지 확인한다.
- 탑승예정자를 인지하기 위해서는 사람의 몸, 얼굴을 인식하는 알고리즘을 사용하여야 하는데 이때 opencv를 활용할 예정이다.
- 라즈베리파이와 카메라를 연결한 후 라즈베리파이에서 opencv를 활용해 실시간으로 얼굴, 몸을 인식하여 탑승 예정자가 있는지 없는지에 대한 값을 서버(AWS EC2 Instance)로 TCP/IP통신을 통해 전달한다. 또한 이때 서버 뿐만 아니라 엘리베이터 버튼에 붙어있는 아두이노에도 값을 전달한다.
feat. 추후에 사용될 수도 있는 데이터를 모으기 위해 시간별, 위치별로 탑승 예정자수 정보를 DB(Mysql)에 기록 및 저장한다.
feat. 아두이노는 라즈베리파이에 비해 연산속도가 느리기 때문에 라즈베리 파이를 이용하여 탑승예정자 유무를 감지한다.
- 아두이노는 전달받은 값에 따라 탑승 예정자가 있다면,  조도 센서를 통해 빛을 감지하여 엘리베이터 버튼이 눌려있는지 확인한 후, 탑승예정자가 없는데 엘리베이터 버튼이 눌려있는 경우 모터(스테핑 모터 or DC 모터) 및 작은 로봇팔을 엘리베이터 버튼을 다시 눌러 취소한다.
feat. 정밀 작업에 쓰이는 스테핑 모터를 사용할지 가격이 저렴한 DC모터를 사용할지는 직접 구현해보며 결정할 예정이다.
feat. 라즈베리파이가 실시간 영상을 받으면서 사람을 인지 하는 것은 좀 느릴수도 있을 것이라 생각된다. 따라서 라즈베리파이3 한대를 이용하여 테스트를 해본 후 느리다면, nvidia tx2 등의 그래픽 연산 최적화 보드를 사거나 라즈베리파이에서 사람을 인지하는 것이 아니라 서버에 영상 데이터를 보내 서버에서 opencv를 돌리고 다시 아두이노로 결과값을 전달하는 방식으로 대체할 것 같다. 최근 엘리베이터에 중계기가 달려있는 경우가 많다고 하니 서버로 보내 처리하는 세번째 방법이 가장 유력 할 것으로 보이나 엘리베이터 안 인터넷 속도 측정을 해보는 등 이 세가지 방법을 모두 시험해 가장 좋은 방법을 택할 예정이다. -> 테스트 사항1

- 엘리베이터 앞에 있는 사람이 탑승 예정자인지를 판단하는 기준은 ‘그 사람이 어느정도 움직이는지’이며, 초기에는 카메라를 벗어나지 않으면 탑승예정자, 벗어나면 탑승예정자가 아닌 것으로 할 것이지만, 이러한 경우 몇초간 어떤 이유로 잠시 카메라를 벗어날 수 있는데 엘리베이터 버튼이 꺼지면 안되므로, 그 몇초를 설정할 때 있어 실제 카메라 설치 후 몇초를 보통 벗어나 있다가 엘리베이터를 타는지 측정 및 데이터 수집 후 학습을 시켜 그 초까지는 버튼을 취소하지 않는 것으로 할 예정이다. -> 보완사항1

|opencv : https://github.com/opencv/opencv

|opencv 전신 정보 데이터 : 
|https://github.com/opencv/opencv/tree/master/data/haarcascades

#### '''탑승인원 인식 시스템'''
- 엘리베이터에 내부에 카메라를 설치하여 영상처리를 통해 몇명이 타고 있는지 확인한다.
- 탑승하고 있는 인원수를 체크하기 위해서는 사람의 머리를 인식해야 하는데 이때, OpenCV Haar Algorithm을 사용하거나 github에 공개되어 있는 “SCUT-HEAD-Dataset-Release”의 사람의 머리 데이터셋을 이용해 학습시키거나 “CNNs for person head detection” 논문을 참고하여 사람의 머리를 인식하여 탑승하고 있는 인원수를 구할 예정이다. 매우 잘 되어 있는 “CNNs for person head detection” 논문을 참고하는 방법을 택할 가능성이 높다.

|참고자료 : 
|http://www.morethantechnical.com/2010/03/19/quick-and-easy-head-pose-estimation-with-opencv-w-code/
|https://github.com/HCIILAB/SCUT-HEAD-Dataset-Release
|https://ieeexplore.ieee.org/document/7410688

- 라즈베리파이와 카메라를 연결한 후 라즈베리파이에서 머리를 인식하여 탑승자가 몇명 있는지 대한 값을 서버(AWS EC2 Instance)로 TCP/IP통신을 통해 전달한다. 
feat. “엘리베이터 버튼 자동 취소 시스템”에서는 서버가 없어도 엘리베이터 버튼 주변에 붙어있는 아두이노로 바로 통신하면 됬지만, 이 “탑승 인원 인식 시스템”의 경우에는 18층에 있는 엘리베이터에 몇명이 있는지 5층에서도 알수 있어야 하므로 서버를 반드시 두고, 서버를 거쳐 라즈베리파이에서 서버로,  서버에서 다시 아두이노로 데이터가 전달되도록 구현 해야한다. 
- 이렇게 아두이노로 전달된 데이터(실시간 엘리베이터 탑승객의 수)를 아두이노와 연결된 디스플레이에 띄워 현재 엘리베이터의 탑승객 수를 나타내준다.
feat. 이 시스템의 경우에도 라즈베리파이가 실시간 영상을 받으면서 사람을 인지 하는 것은 좀 느릴수도 있을 것이라 생각된다. 따라서 라즈베리파이3 한대를 이용하여 테스트를 해본 후 느리다면, nvidia tx2 등의 그래픽 연산 최적화 보드를 사거나 라즈베리파이에서 사람을 인지하는 것이 아니라 서버에 영상 데이터를 보내 서버에서 opencv를 돌리고 다시 아두이노로 결과값을 전달하는 방식으로 대체할 것 같다. 최근 엘리베이터에 중계기가 달려있는 경우가 많다고 하니 서버로 보내 처리하는 세번째 방법이 가장 유력 할 것으로 보이나 엘리베이터 안 인터넷 속도 측정을 해보는 등 이 세가지 방법을 모두 시험해 가장 좋은 방법을 택할 예정이다. ->'''테스트 사항 2'''

### 주간 진행 계획(팀 관점)

2주차~3주차 사이 : 멘토님께 피드백을 받은 후 주제를 보완하고 이를 반영하여 3주차 진행 현황 발표자료를 만든다. 아두이노와 라즈베리파이3의 통신, 디스플레이와 모터 연결 등 사용법에 대해 확실히 익힌다. 
3주차~4주차 사이 : 발표를 하고 난 후, 조교님과 교수님께 받은 피드백을 반영하여 주제를 보완하고, OpenCV를 공부하여 엘리베이터 버튼 자동 취소 시스템을 위한 사람 몸, 얼굴 인식 알고리즘을 OpenCV를 이용해 짜기 시작한다. “CNNs for person head detection” 논문을 참고하여 사람 머리를 인식하여 사람의 수를 세는 알고리즘 또한 짜기 시작한다.

4주차~5주차 사이 : 멘토님께 피드백을 받은 후 주제를 보완하고, 이를 반영하여 5주차 진행 현황 발표자료를 만든다. 사람의 얼굴, 몸, 머리 인식 알고리즘은 계속 공부하고 코딩하는 것을 이어나가며, OpenCV를 이용해 사람 몸, 얼굴을 인식하여 탑승예정자의 유무를 판단하는 알고리즘은 마무리하여, 카메라와 라즈베리 파이, 아두이노, 소형 로봇팔, 모터를 이용해 엘리베이터 버튼 자동 취소 시스템 구축을 시작한다.
5주차~6주차 사이 : 발표를 하고 난 후, 조교님과 교수님께 받은 피드백과 멘토님께 받은 피드백을 반영하여 주제를 보완하고, 6주차 진행현황 발표자료를 만든다. 사람 머리를 인식하여 사람의 수를 세는 알고리즘을 마무리하여, 라즈베리 파이와 카메라를 이용하여 탑승인원 인식 시스템 구축을 시작한다. 엘리베이터 버튼 자동 취소 시스템 구축 또한 이어서 한다.
* 아래부터 피드백을 받아 주제를 보완하고 발표자료를 만든다는 것은 생략하겠습니다.
6주차~7주차 사이 : 엘리베이터 버튼 자동 취소 시스템 구축과 탑승인원 인식 시스템 구축을 함께 진행하며 엘리베이터 안 밖의 기기가 연결이 되도록 한다.

7주차~9주차 사이 : 엘리베이터 버튼 자동 취소 시스템 구축과 탑승인원 인식 시스템 구축을 마무리하고 실제 엘리베이터에서의 테스트 허가를 받고 테스트를 시작한다.
9주차~13주차 사이 : 테스트를 하며 부족한 부분을 수정, 보완하고 앞에서 말한 테스트 사항1, 2 및 보완사항 1을 개발, 적용해봄으로써, 속도 및 정확성의 측면에서 시스템의 완성도를 높인다.

13주차~15주차 사이 : 최종 발표 및 데모 준비를 함께 하며, 수정해야할 부분, 에러부분을 고치고, 최종 보고서 또한 함께 준비, 작성하여 제출한다.

### 주간 진행 계획(팀원별 진행 상황)

저희 프로젝트 특성상 다 같이 모여 작업을 하고 
함께 연결작업 등을 하여 테스트를 해보며 진행해야 함.

따라서 위와 같은 각 주차에서 할일을 앞에서 말한 조원별 역할에 따라 수행할 예정.


 
